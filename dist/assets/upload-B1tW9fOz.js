import{d as R,g as l,ag as U,f as j,m as B,e as a,q as d,v as t,G as n,z as r,E as w,u as b,y as S,M as k,O as A,C as c}from"./index-wlcSVvoI.js";import{c as G}from"./dataset-DBM0yH9-.js";const J={class:"dataset-upload-container"},K={class:"upload-status"},Q={key:0},W={class:"form-actions"},te=R({__name:"upload",setup(Y){const M=U(),h=A(),_=l(M.params.id),m=l(!1),p=l(null),s=l(null),u=l(""),i=l(!1),D=l(0),F=l("准备中"),y=l(null);l("");const x=l(null),T=l({indexing_technique:"high_quality",doc_form:"hierarchical_model",doc_language:"Chinese",embedding_model:"bge-m3:latest",embedding_model_provider:"langgenius/ollama/ollama",retrieval_model:{search_method:"hybrid_search",reranking_enable:!0,reranking_model:{reranking_provider_name:"langgenius/xinference/xinference",reranking_model_name:"bge-reranker-v2-m3"},top_k:8,score_threshold_enabled:!0,score_threshold:.15,reranking_mode:"reranking_model",weights:{weight_type:"customized",vector_setting:{vector_weight:.7,embedding_provider_name:"",embedding_model_name:""},keyword_setting:{keyword_weight:.3}}},process_rule:{mode:"hierarchical",rules:{pre_processing_rules:[{id:"remove_extra_spaces",enabled:!0},{id:"remove_urls_emails",enabled:!1}],segmentation:{separator:`

`,max_tokens:500},parent_mode:"paragraph",subchunk_segmentation:{separator:`
`,max_tokens:200}}}}),I=()=>{p.value.click()},N=o=>{const e=o.target.files;e&&e.length>0&&(s.value=e[0],u.value=e[0].name)},X=()=>{s.value=null,u.value="",p.value&&(p.value.value="")},V=async()=>{if(!s.value){k.warning("请先选择一个文件");return}if(s.value.size>15*1024*1024){k.error("文件大小不能超过15MB");return}try{m.value=!0,i.value=!0,D.value=0,F.value="上传中";const o=new FormData;o.append("file",s.value);const e={...T.value};console.log("准备上传文件:",s.value.name,"配置:",e),o.append("data",JSON.stringify(e));const f=await G(_.value,o);console.log("文件上传成功:",f),k.success("文件已上传，正在处理中"),h.push(`/app/dataset/detail/${_.value}`)}catch(o){console.error("文件上传失败:",o),k.error("文件上传失败"),i.value=!1}finally{m.value=!1}},C=()=>{i.value?confirm("文件正在处理中，确定要离开吗？")&&(clearInterval(x.value),h.push(`/app/dataset/detail/${_.value}`)):h.push(`/app/dataset/detail/${_.value}`)};return j(()=>{x.value&&clearInterval(x.value)}),(o,e)=>{const f=n("t-breadcrumb-item"),O=n("t-breadcrumb"),q=n("t-icon"),z=n("t-input"),v=n("t-button"),g=n("t-form-item"),L=n("t-progress"),P=n("t-space"),$=n("t-form"),E=n("t-loading"),H=n("t-card");return c(),B("div",J,[a(O,{class:"breadcrumb"},{default:t(()=>[a(f,{onClick:C},{default:t(()=>e[0]||(e[0]=[r("知识库文档")])),_:1}),a(f,null,{default:t(()=>e[1]||(e[1]=[r("上传文档")])),_:1})]),_:1}),a(H,{title:"上传文档"},{default:t(()=>[a(E,{loading:m.value},{default:t(()=>[a($,{class:"upload-form","label-width":"120px"},{default:t(()=>[a(g,{label:"文档文件",name:"file"},{default:t(()=>[u.value?(c(),w(z,{key:0,value:u.value,readonly:"",placeholder:"已选择文件",style:{marginBottom:"8px"}},{suffix:t(()=>[a(q,{name:"close-circle-filled",onClick:X,style:{cursor:"pointer"}})]),_:1},8,["value"])):b("",!0),u.value?b("",!0):(c(),w(v,{key:1,onClick:I},{default:t(()=>e[2]||(e[2]=[r(" 选择文件 ")])),_:1})),d("input",{type:"file",ref_key:"fileInput",ref:p,style:{display:"none"},accept:".txt,.md,.mdx,.pdf,.html,.htm,.xlsx,.xls,.docx,.csv",onChange:N},null,544)]),_:1}),a(g,null,{default:t(()=>e[3]||(e[3]=[d("div",{class:"file-limits"}," 支持的文件类型：TXT、MD、MDX、PDF、HTML、XLSX、XLS、DOCX、CSV、HTM，单个文件不超过15MB ",-1)])),_:1}),i.value?(c(),w(g,{key:0},{default:t(()=>[a(L,{percentage:D.value,color:{from:"#0052D9",to:"#00A870"}},null,8,["percentage"]),d("div",K,[d("span",null,"状态: "+S(F.value),1),y.value?(c(),B("span",Q,"已处理: "+S(y.value.completed_segments||0)+"/"+S(y.value.total_segments||0)+" 段",1)):b("",!0)])]),_:1})):b("",!0),a(g,null,{default:t(()=>[a(P,null,{default:t(()=>[a(v,{theme:"primary",onClick:V,loading:m.value,disabled:!s.value||i.value},{default:t(()=>e[4]||(e[4]=[r("上传")])),_:1},8,["loading","disabled"]),a(v,{theme:"default",onClick:C},{default:t(()=>e[5]||(e[5]=[r("取消")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),d("div",W,[a(v,{theme:"default",onClick:C},{default:t(()=>e[6]||(e[6]=[r("返回文档列表")])),_:1})])])}}});export{te as default};
