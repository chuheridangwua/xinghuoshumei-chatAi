const h={baseURL:"/api/v1",apiKey:"app-JUQYZhaSvAhw9YtuhOCo66A6",workflowApiKey:"app-6aRhLAp4zAppCJus5ViMgOsh",datasetApiKey:"dataset-NU4Kg7Wtm1616AOnxnRAeFct"},w=(r,e)=>{const t=`${e}${r}`;return t.startsWith("http://")||t.startsWith("https://")?new URL(t):new URL(t,window.location.origin)},c=()=>{const r=new AbortController,e=r.signal;return{controller:r,signal:e,abortRequest:()=>{if(r.signal.aborted)console.log("请求已经被中断，不再重复执行");else try{console.log("执行请求中断操作"),r.abort(),console.log("请求中断完成")}catch(t){console.error("中断请求时出错:",t)}}}},i=r=>w(r,h.baseURL).toString(),p=()=>({"Content-Type":"application/json",Authorization:`Bearer ${h.datasetApiKey}`}),u=async(r={})=>{const{page:e=1,limit:s=20}=r,{signal:t}=c();try{const o=new URL(i("/datasets"));o.searchParams.append("page",e),o.searchParams.append("limit",s);const n=await fetch(o.toString(),{method:"GET",headers:p(),signal:t});if(!n.ok)throw new Error(`获取知识库列表失败: ${n.status}`);return await n.json()}catch(o){throw console.error("获取知识库列表错误:",o),o}},g=async(r,e={})=>{if(!r)throw new Error("知识库ID不能为空");const{page:s=1,limit:t=20,keyword:o}=e,{signal:n}=c();try{const a=new URL(i(`/datasets/${r}/documents`));a.searchParams.append("page",s),a.searchParams.append("limit",t),o&&a.searchParams.append("keyword",o);const l=await fetch(a.toString(),{method:"GET",headers:p(),signal:n});if(!l.ok)throw new Error(`获取文档列表失败: ${l.status}`);return await l.json()}catch(a){throw console.error("获取文档列表错误:",a),a}},d=async(r,e)=>{if(!r)throw new Error("知识库ID不能为空");const{signal:s}=c();try{const t=await fetch(i(`/datasets/${r}/document/create-by-file`),{method:"POST",headers:{Authorization:`Bearer ${h.datasetApiKey}`},body:e,signal:s});if(!t.ok)throw new Error(`通过文件创建文档失败: ${t.status}`);return await t.json()}catch(t){throw console.error("通过文件创建文档错误:",t),t}},m=async(r,e)=>{if(!r||!e)throw new Error("知识库ID和批次号不能为空");const{signal:s}=c();try{const t=await fetch(i(`/datasets/${r}/documents/${e}/indexing-status`),{method:"GET",headers:p(),signal:s});if(!t.ok)throw new Error(`获取文档索引状态失败: ${t.status}`);return await t.json()}catch(t){throw console.error("获取文档索引状态错误:",t),t}};export{g as a,m as b,d as c,u as g};
