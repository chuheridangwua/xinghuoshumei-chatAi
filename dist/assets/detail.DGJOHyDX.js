import{h as R,j as i,V as j,x as U,l as $,c as w,a as r,w as n,r as c,M as F,p as m,n as y,t as b,m as G,v as z,E as H,o as _}from"./vendor.CamtBdHc.js";import{a as J,b as O}from"./dataset.DBM0yH9-.js";const Q={class:"dataset-detail-container"},W={key:0,class:"debug-info"},X={class:"status-wrapper"},te=R({__name:"detail",setup(Y){const D=j(),x=H(),v=i(D.params.id),h=i(!0),s=i([]),l=i({current:1,pageSize:10,total:0}),g=i({}),u=i(null),P=e=>e?new Date(e*1e3).toLocaleString():"",p=e=>["waiting","queuing","indexing"].includes(e),I=[{colKey:"index",title:"序号",width:"80",cell:(e,{rowIndex:t})=>(l.value.current-1)*l.value.pageSize+t+1},{colKey:"name",title:"文档名称"},{colKey:"display_status",title:"状态",cell:"statusCol",width:"180"},{colKey:"word_count",title:"字数"},{colKey:"created_at",title:"创建时间",cell:"createdAtCol"}],f=async()=>{h.value=!0;try{const e=await J(v.value,{page:l.value.current,limit:l.value.pageSize});Array.isArray(e.data)?s.value=e.data:e.data?s.value=[e.data]:s.value=[],l.value.total=e.total||0,console.log("获取到文档列表:",s.value),M()}catch(e){console.error("获取文档列表失败:",e),F.error("获取文档列表失败"),s.value=[]}finally{h.value=!1}},M=()=>{u.value&&clearInterval(u.value);const e=s.value.filter(t=>p(t.display_status));e.length>0&&(e.forEach(t=>{t.batch&&k(t.id,t.batch)}),u.value=setInterval(()=>{let t=!1;s.value.forEach(a=>{p(a.display_status)&&a.batch&&(k(a.id,a.batch),t=!0)}),t||clearInterval(u.value)},500))},k=async(e,t)=>{try{const a=await O(v.value,t);if(a&&a.data&&a.data.length>0){const d=a.data[0];g.value[e]=d,(d.indexing_status==="completed"||d.indexing_status==="error")&&setTimeout(()=>{f()},1e3)}}catch(a){console.error("获取文档处理状态失败:",a)}},K=e=>!e||!e.total_segments||e.total_segments===0?0:Math.floor(e.completed_segments/e.total_segments*100),C=e=>({waiting:{text:"等待中",theme:"warning"},indexing:{text:"处理中",theme:"primary"},completed:{text:"已完成",theme:"success"},error:{text:"错误",theme:"danger"},queuing:{text:"排队中",theme:"warning"}})[e]||{text:e,theme:"default"},L=e=>{l.value.current=e.current,l.value.pageSize=e.pageSize,f()},V=()=>{x.push(`/app/dataset/upload/${v.value}`)},A=()=>{x.push("/app/dataset")};return U(()=>{f()}),$(()=>{u.value&&clearInterval(u.value)}),(e,t)=>{const a=c("t-breadcrumb-item"),d=c("t-breadcrumb"),B=c("t-button"),S=c("t-loading"),E=c("t-tag"),N=c("t-progress"),T=c("t-table"),q=c("t-card");return _(),w("div",Q,[r(d,{class:"breadcrumb"},{default:n(()=>[r(a,{onClick:A},{default:n(()=>t[0]||(t[0]=[m("知识库列表")])),_:1}),r(a,null,{default:n(()=>t[1]||(t[1]=[m("知识库文档")])),_:1})]),_:1}),r(q,{title:"文档列表",class:"document-list-card"},{actions:n(()=>[r(B,{theme:"primary",onClick:V},{default:n(()=>t[2]||(t[2]=[m("上传文档")])),_:1})]),default:n(()=>[r(S,{loading:h.value},{default:n(()=>[s.value.length>0?(_(),w("div",W," 已加载 "+b(s.value.length)+" 条记录 ",1)):y("",!0),r(T,{data:s.value,columns:I,"row-key":"id",stripe:"",hover:"",pagination:l.value,onPageChange:L,empty:"暂无文档"},{statusCol:n(({row:o})=>[G("div",X,[p(o.display_status)?(_(),z(S,{key:0,size:"small",loading:!0})):y("",!0),r(E,{theme:C(o.display_status).theme},{default:n(()=>[m(b(C(o.display_status).text),1)]),_:2},1032,["theme"]),p(o.display_status)&&g.value[o.id]&&g.value[o.id].total_segments>0?(_(),z(N,{key:1,theme:"line",size:"small",percentage:K(g.value[o.id]),label:!1,class:"status-progress"},null,8,["percentage"])):y("",!0)])]),createdAtCol:n(({row:o})=>[m(b(P(o.created_at)),1)]),_:1},8,["data","pagination"])]),_:1},8,["loading"])]),_:1})])}}});export{te as default};
//# sourceMappingURL=detail.DGJOHyDX.js.map
